<?php

namespace app\index\controller;

use app\common\controller\Frontend;

class About extends Frontend
{

    protected $noNeedLogin = '*';
    protected $noNeedRight = '*';
    protected $layout = '';

    // 了解我们
    public function index()
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $articleList = db('article')
            ->where('article_category_id', $subMenu['id'])
            ->order('weigh desc, id asc')
            ->limit(4)
            ->select();

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleList', $articleList);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 公司简介
    public function about($id=0)
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $articleDetail = db('article')
            ->where('id', $id)
            ->find();

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业文化
    public function wenhua($id=0)
    {

        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $articleDetail = db('article')
            ->where('id', $id)
            ->find();

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业荣誉
    public function hoor($id=0)
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $articleDetail = db('article')
            ->where('id', $id)
            ->find();

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业风采
    public function style()
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $parentMenu = db('article_category')
            ->where('id', $subMenu['parent_id'])
            ->find();

        $articleList = db('article')
            ->where('article_category_id', $subMenu['id'])
            ->order('weigh desc, id asc')
            ->limit(2)
            ->select();
        if(!empty($articleList))
        {
            foreach($articleList as &$v)
            {
                $v['bigTime'] = date('d', $v['createtime']);
                $v['smallTime'] = date('Y-m', $v['createtime']);
            }
            unset($v);
        }

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('parentMenu', $parentMenu);
        $this->assign('articleList', $articleList);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业风采-文章详情
    public function detail($id=0)
    {
        $articleDetail = db('article')
            ->where('id', $id)
            ->find();

        $subMenu = db('article_category')
            ->where('id', $articleDetail['article_category_id'])
            ->find();

        $this->assign('articleDetail', $articleDetail);
        $this->assign('subMenu', $subMenu);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 成功案例
    public function cases()
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $articleList = db('article')
            ->where('article_category_id', '=', $subMenu['id'])
            ->field('id, title, info, image')
            ->order('weigh desc, id desc')
            ->paginate(12);

        $this->assign('sign', 'about');
        $this->assign('articleList', $articleList);
        $this->assign('subMenu', $subMenu);
        return $this->view->fetch();
    }

}
