<?php

namespace app\index\controller;

use app\common\controller\Frontend;

class About extends Frontend
{

    protected $noNeedLogin = '*';
    protected $noNeedRight = '*';
    protected $layout = '';

    // 了解我们
    public function index()
    {
        $image = getImage('images, link', 2, 1);

        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'id, article_category_name, top_title, top_info, top_image');

        $articleList = getArticleList('article_category_id', $subMenu['id'], 'id, image, title, info', 4);

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleList', $articleList);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 公司简介
    public function about($id=0)
    {
        $image = getImage('images, link', 6, 1);

        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'article_category_name');

        $articleDetail = getArticleDetail('id', $id, 'image, title, content, info');

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业文化
    public function wenhua($id=0)
    {
        $image = getImage('images, link', 7, 1);

        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'article_category_name');

        $articleDetail = getArticleDetail('id', $id, 'image, title, content, info');

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业荣誉
    public function hoor($id=0)
    {
        $image = getImage('images, link', 8, 1);

        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'article_category_name');

        $articleDetail = getArticleDetail('id', $id, 'image, title, content, info');

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('articleDetail', $articleDetail);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业风采
    public function style()
    {
        $image = getImage('images, link', 9, 1);
        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'id, article_category_name, parent_id');

        $parentMenu = getArticleCategoryDetail('id', $subMenu['parent_id'], 'id, article_category_name, link');

        $articleList = getArticleList('article_category_id', $subMenu['id'], 'id, image, title, from_unixtime(createtime, "%d") as bigTime, from_unixtime(createtime, "%Y-%m") as smallTime', 2);

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('parentMenu', $parentMenu);
        $this->assign('articleList', $articleList);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 企业风采-文章详情
    public function detail($id=0)
    {
        $articleDetail = getArticleDetail('id', $id, 'image, title, content, info, article_category_id');

        $subMenu = getArticleCategoryDetail('id', $articleDetail['article_category_id'], 'article_category_name, link');

        $this->assign('articleDetail', $articleDetail);
        $this->assign('subMenu', $subMenu);
        $this->assign('sign', 'about');
        return $this->view->fetch();
    }

    // 成功案例
    public function cases()
    {
        $subMenu = getArticleCategoryDetail('link', '/'.$this->request->pathinfo(), 'id, top_title, top_info');
        $articleList = db('article')
            ->where('article_category_id', '=', $subMenu['id'])
            ->field('id, title, info, image')
            ->order('weigh desc, id desc')
            ->paginate(12);

        $this->assign('sign', 'about');
        $this->assign('articleList', $articleList);
        $this->assign('subMenu', $subMenu);
        return $this->view->fetch();
    }

}
