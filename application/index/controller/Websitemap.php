<?php

namespace app\index\controller;

use app\common\controller\Frontend;

class Websitemap extends Frontend
{

    protected $noNeedLogin = '*';
    protected $noNeedRight = '*';
    protected $layout = '';

    public function index()
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $list = db('website_map_category')
            ->order('weigh desc, id asc')
            ->select();
        if(!empty($list))
        {
            foreach($list as $k=>&$v)
            {
                $v['link'] = !empty($v['link']) ? $v['link'] : 'javascript:void(0);';
                $v['linkList'] = db('website_map_link')
                    ->where('website_map_category_id', $v['id'])
                    ->order('weigh desc, id asc')
                    ->select();
                if(!empty($v['linkList']))
                {
                    foreach($v['linkList'] as &$v1)
                    {
                        $v1['link'] = !empty($v1['link']) ? $v1['link'] : 'javascript:void(0);';
                    }
                    unset($v1);
                }
            }
            unset($v);
        }

        $title= !empty($subMenu['seo_title']) ? $subMenu['seo_title'] : $this->site['seo_title'];
        $keywords = !empty($subMenu['seo_keywords']) ? $subMenu['seo_keywords'] : $this->site['seo_keywords'];
        $description = !empty($subMenu['seo_description']) ? $subMenu['seo_description'] : $this->site['seo_description'];
        $this->assign('title', $title);
        $this->assign('keywords', $keywords);
        $this->assign('description', $description);

        $this->assign('subMenu', $subMenu);
        $this->assign('image', $image);
        $this->assign('list', $list);
        $this->assign('sign', '');
        return $this->view->fetch();
    }

}