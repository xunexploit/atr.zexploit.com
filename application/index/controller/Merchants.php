<?php

namespace app\index\controller;

use app\common\controller\Frontend;

class Merchants extends Frontend
{
    protected $noNeedLogin = '*';
    protected $noNeedRight = '*';
    protected $layout = '';

    // 招商加盟
    public function index()
    {
        // 当前文章分类
        $subMenu = db('article_category')
            ->where('link', '/'.$this->request->pathinfo())
            ->find();

        $image = db('images')
            ->where('article_category_id', $subMenu['id'])
            ->find();

        $childMenuList = db('article_category')->where('parent_id', $subMenu['id'])->order('weigh desc, id asc')->limit(3)->select();
        $articleList_1 = db('article')->where('article_category_id', $childMenuList[0]['id'])->order('weigh desc, id asc')->limit(3)->select();
        $articleList_2 = db('article')->where('article_category_id', $childMenuList[1]['id'])->order('weigh desc, id asc')->limit(1)->select();
        $articleList_3 = db('article')->where('article_category_id', $childMenuList[2]['id'])->order('weigh desc, id asc')->limit(1)->select();

        $this->assign('image', $image);
        $this->assign('subMenu', $subMenu);
        $this->assign('sign', 'merchants');
        $this->assign('childMenuList', $childMenuList);
        $this->assign('articleList_1', $articleList_1);
        $this->assign('articleList_2', $articleList_2);
        $this->assign('articleList_3', $articleList_3);
        return $this->view->fetch();
    }

    // 招商加盟-项目优势-文章详情
    public function youshi($id=0)
    {
        // 文章详情
        $articleDetail = db('article')
            ->where('id', $id)
            ->find();

        $image = db('images')->where('article_category_id', $articleDetail['article_category_id'])->find();

        // 文章分类
        $subMenu = db('article_category')->where('id', $articleDetail['article_category_id'])->find();

        $this->assign('image', $image);
        $this->assign('sign', 'merchants');
        $this->assign('articleDetail', $articleDetail);
        $this->assign('subMenu', $subMenu);
        return $this->view->fetch();
    }
}