<?php

namespace app\index\controller;

use app\common\controller\Frontend;

class Search extends Frontend
{

    protected $noNeedLogin = '*';
    protected $noNeedRight = '*';
    protected $layout = '';

    // 搜索主页
    public function index()
    {
        $keyword = $this->request->post('keyboard');
        // if(empty($keyword)) $this->error('请填写产品名称');

        $productList = db('goods')
            ->alias('a')
            ->join('article_category b','a.article_category_id = b.id')
            ->where('a.title', 'like', '%'.$keyword.'%')
            ->order('a.weigh desc, a.id desc')
            ->field('a.id, a.title, a.images, a.article_category_id, b.article_category_name, a.is_tuijian')
            ->paginate(12)->each(function($item, $key){
                $item['images'] = explode(',', $item['images'] );
                return $item;
            });

        $count = db('goods')
            ->alias('a')
            ->join('article_category b','a.article_category_id = b.id')
            ->where('a.title', 'like', '%'.$keyword.'%')
            ->count();

        $this->assign('keyword', $keyword);
        $this->assign('productList', $productList);
        $this->assign('count', $count);
        $this->assign('sign', '');
        return $this->view->fetch();
    }
}
